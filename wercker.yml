build:
  box: samueldebruyn/hugo-build
  steps:
    - script:
        name: initialize git submodules
        code: |
            git submodule update --init --recursive
    - samueldebruyn/copy-files:
        source: staging
        destination: static
        ignore_branches: master
    - arjen/hugo-build@1.6.1:
        prod_branches: master
        dev_flags: --config=config-dev.toml
#    - samueldebruyn/minify:
#        only_on_branches: master

dev:
  box: samueldebruyn/hugo-build
  steps:
    - script:
        name: initialize git submodules
        code: |
            git submodule update --init --recursive
    - arjen/hugo-build@1.6.1:
        prod_branches: master
        dev_flags: --config=config-dev.toml
    - samueldebruyn/minify:
            only_on_branches: master

deploy:
  box: samueldebruyn/hugo-build
  steps:
    - wercker/s3sync@2.0.3:
        key-id: $KEY
        key-secret: $SECRET
        bucket-url: s3://$BUCKET
        source-dir: public
        opts: --acl-private
